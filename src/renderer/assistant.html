<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Assistant</title>
    <link rel="stylesheet" href="css/assistant.css">
    
    <!-- Prevent flash with inline CSS -->
    <style>
        html, body {
            background: transparent !important;
            margin: 0;
            padding: 0;
        }
        
        /* Simple loading styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(246, 246, 246, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-top: 2px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ensure body shows properly */
        body {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        body.loaded {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Loading overlay -->
    <div class="loading-overlay">
        <div style="text-align: center; color: #666;">
            <div class="loading-spinner" style="margin: 0 auto 10px;"></div>
            Loading...
        </div>
    </div>
    
    <div id="app" class="app-container">
        <div class="assistant-panel">
            <!-- Header with title and controls -->
            <div class="panel-header">
                <div class="title">
                    <span class="icon">ü§ñ</span>
                    <span class="text">LLM Assistant</span>
                </div>
                <div class="controls">
                    <button id="settings-btn" class="control-btn" title="Settings">‚öôÔ∏è</button>
                    <button id="hide-btn" class="control-btn" title="Hide (Cmd+Option+L to show again)">‚àí</button>
                    <button id="quit-btn" class="control-btn quit-btn" title="Quit Application">‚úï</button>
                </div>
            </div>

            <!-- Context indicator -->
            <div id="context-indicator" class="context-indicator hidden">
                <div class="context-icon">üìß</div>
                <div class="context-info">
                    <div class="context-title">Mail Context Detected</div>
                    <div class="context-details"></div>
                </div>
            </div>

            <!-- Window selector (shown when multiple Mail windows detected) -->
            <div id="window-selector" class="window-selector hidden">
                <div class="window-selector-header">
                    <label for="window-dropdown" class="selector-title">Mail window:</label>
                    <button id="refresh-windows-btn" class="icon-btn" title="Refresh window list">üîÑ</button>
                </div>
                <select id="window-dropdown" class="window-dropdown">
                    <!-- Options will be dynamically added here -->
                </select>
            </div>

            <!-- Quick action buttons -->
            <div id="quick-actions" class="quick-actions">
                <button class="action-btn" data-action="summarize">
                    <span class="action-icon">üìù</span>
                    <span class="action-text">Summarize</span>
                </button>
                <button class="action-btn" data-action="translate">
                    <span class="action-icon">üåê</span>
                    <span class="action-text">Translate</span>
                </button>
                <button class="action-btn" data-action="improve">
                    <span class="action-icon">‚ú®</span>
                    <span class="action-text">Improve</span>
                </button>
                <button class="action-btn" data-action="reply">
                    <span class="action-icon">‚Ü©Ô∏è</span>
                    <span class="action-text">Draft Reply</span>
                </button>
            </div>

            <!-- Text input area -->
            <div class="input-section">
                <div class="input-header">
                    <label for="user-input">Describe what you need:</label>
                    <div class="privacy-indicator">
                        <span id="privacy-status" class="privacy-safe">üîí Safe</span>
                    </div>
                </div>
                <textarea 
                    id="user-input" 
                    placeholder="e.g., Help me write a professional response to this email thread..."
                    rows="3"
                ></textarea>
                
                <!-- Privacy warning for filtered content -->
                <div id="privacy-warning" class="privacy-warning hidden">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-text">
                        <span id="filtered-count">0</span> sensitive items filtered
                        <button id="show-filtered" class="link-btn">Show details</button>
                    </div>
                </div>
            </div>

            <!-- Processing indicator -->
            <div id="processing" class="processing hidden">
                <div class="processing-spinner"></div>
                <div class="processing-text">Processing with AI...</div>
            </div>

            <!-- Results area -->
            <div id="results" class="results hidden">
                <div class="results-header">
                    <span class="results-title">AI Response</span>
                    <div class="results-actions">
                        <button id="copy-result" class="icon-btn" title="Copy">üìã</button>
                        <button id="apply-result" class="icon-btn" title="Apply">‚úÖ</button>
                    </div>
                </div>
                <div id="results-content" class="results-content"></div>
            </div>

            <!-- Action buttons -->
            <div class="action-bar">
                <button id="process-btn" class="primary-btn">
                    <span class="btn-icon">üöÄ</span>
                    <span class="btn-text">Process</span>
                </button>
                <button id="clear-btn" class="secondary-btn">Clear</button>
            </div>

            <!-- Settings panel (initially hidden) -->
            <div id="settings-panel" class="settings-panel hidden">
                <div class="settings-header">
                    <h3>Settings</h3>
                    <button id="settings-close" class="control-btn">‚úï</button>
                </div>
                
                <div class="settings-content">
                    <div class="setting-group">
                        <label for="openai-key">OpenAI API Key:</label>
                        <input type="password" id="openai-key" placeholder="sk-...">
                        <small class="help-text">Your API key is stored locally and encrypted</small>
                    </div>
                    
                    <div class="setting-group">
                        <label>Privacy Settings:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="filter-api-keys" checked>
                                <span>Filter API keys and tokens</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="filter-credentials" checked>
                                <span>Filter login credentials</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="filter-financial" checked>
                                <span>Filter financial information</span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label for="model-select">AI Model:</label>
                        <select id="model-select">
                            <!-- Models will be loaded dynamically -->
                            <option value="">Loading models...</option>
                        </select>
                        <small class="help-text">Models are loaded from config/models.json</small>
                    </div>

                    <div class="setting-group">
                        <label>Custom Prompts:</label>
                        <small class="help-text">Customize AI prompts for different actions</small>

                        <div style="margin-top: 0.5rem;">
                            <label for="prompt-system" style="font-size: 0.9rem;">System Prompt (Base):</label>
                            <input type="text" id="prompt-system" placeholder="You are a helpful AI assistant for email and text processing.">
                        </div>

                        <div style="margin-top: 0.5rem;">
                            <label for="prompt-compose" style="font-size: 0.9rem;">Compose Context Addition:</label>
                            <input type="text" id="prompt-compose" placeholder="The user is composing an email. Provide concise, professional assistance.">
                        </div>

                        <div style="margin-top: 0.5rem;">
                            <label for="prompt-mailbox" style="font-size: 0.9rem;">Mailbox Context Addition:</label>
                            <input type="text" id="prompt-mailbox" placeholder="The user is working with email threads. Help them understand and respond to conversations.">
                        </div>

                        <div style="margin-top: 0.5rem;">
                            <label for="prompt-summarize" style="font-size: 0.9rem;">Summarize Prompt:</label>
                            <input type="text" id="prompt-summarize" placeholder="Please summarize this text concisely, highlighting the key points:">
                        </div>

                        <div style="margin-top: 0.5rem;">
                            <label for="prompt-translate" style="font-size: 0.9rem;">Translate Prompt:</label>
                            <input type="text" id="prompt-translate" placeholder="Please translate this text to English...">
                        </div>

                        <div style="margin-top: 0.5rem;">
                            <label for="prompt-improve" style="font-size: 0.9rem;">Improve Prompt:</label>
                            <input type="text" id="prompt-improve" placeholder="Please improve this text for clarity, tone, and professionalism:">
                        </div>

                        <div style="margin-top: 0.5rem;">
                            <label for="prompt-reply" style="font-size: 0.9rem;">Reply Prompt:</label>
                            <input type="text" id="prompt-reply" placeholder="Help me draft a professional email reply to this:">
                        </div>
                    </div>
                </div>
                
                <div class="settings-footer">
                    <button id="save-settings" class="primary-btn">Save</button>
                </div>
            </div>

            <!-- Resize Handle -->
            <div class="resize-handle"></div>
        </div>
    </div>

    <!-- Load JavaScript -->
    <script src="js/assistant.js"></script>
</body>
</html>